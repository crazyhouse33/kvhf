#!/usr/bin/python3
import kvhf.bin.kvhfplot.parser as parser
from kvhf.file import KVH_file
from kvhf.bin.kvhfplot.selection import *


args= parser.getArgs()

paths= args["file"]
sep_key = args["sep_key"] 
sep_val=args["sep_val"]
keys=args["keys"]
keys_filter= args["keys_filter"]
labels = args["labels"]
labels_filter=args["labels_filter"]
ylabel = args["y_label"]
unity=args["unity"]
out_path=args['out_path']
out_format= args['out_format']
plot= args['plot']

the_file= KVH_file(paths[0], key_sep=sep_key, value_sep=sep_val)
for path in paths[1::]:
    f= KVH_file(path, key_sep=sep_key, value_sep=sep_val)
    the_file.merge_vertical(f)
 
matched_keys = select_keys(the_file, keys, keys_filter, unity)

pos = select_pos(the_file, labels, labels_filter)

if len(pos) == 1:
    the_file.draw_pie(matched_keys, it=pos[0])
else:
    the_file.draw_history(matched_keys, ylabel, pos)

if out_path:        
    the_file.save_img(out_path, out_format)

if not out_path or plot:
    the_file.plot()








    
    
